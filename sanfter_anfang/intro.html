<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="justthisspace — sanfter Anfang. Illusionen entladen, die nie stattgefunden haben.">
  <title>Illusionen entladen – justthisspace</title>

  <!-- Optional: gleiche Tech-Mono-Anmutung -->
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fdfdfd;
      --ink:#111111;
      --muted:#6b6b6b;
      --edge:#e5e1d8;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(900px 700px at 50% -10%, rgba(0,0,0,0.06), transparent 70%),
        radial-gradient(700px 600px at 50% 110%, rgba(0,0,0,0.04), transparent 70%),
        linear-gradient(to bottom,#fdfcf9,#f6f3ed);
      color:var(--ink);
      font-family:'Share Tech Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      line-height:1.7;
      letter-spacing:.02em;
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      transition:opacity 1s ease-in;
    }
    body.fadeout{opacity:0;}

    /* Header im JTS-Stil */
    header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter:saturate(180%) blur(10px);
      -webkit-backdrop-filter:saturate(180%) blur(10px);
      background:color-mix(in oklch,#f6f3ed 84%, #ffffff);
      border-bottom:1px solid rgba(0,0,0,0.06);
    }
    .wrap{
      max-width:880px;
      margin:0 auto;
      padding:0.55rem 1rem;
    }
    .row{
      display:flex;
      gap:.75rem;
      align-items:center;
      flex-wrap:wrap;
    }
    .spacer{flex:1 1 auto;}

    .title-head{
      font-size:clamp(1.0rem,0.9rem + 1.2vw,1.4rem);
      margin:0.05rem 0;
      letter-spacing:0.18em;
      text-transform:uppercase;
    }
    label.muted{
      color:var(--muted);
      font-size:.9rem;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.45rem;
      padding:.28rem .9rem;
      border-radius:999px;
      font-size:.9rem;
      cursor:pointer;
      isolation:isolate;
      position:relative;
      text-decoration:none;
      background:radial-gradient(circle at 30% 30%,
                #f8e4b7 0%, #ddb266 45%, #b28b47 100%);
      color:#fff;
      border:1px solid rgba(178,139,71,0.35);
      box-shadow:
        0 3px 8px rgba(0,0,0,0.18),
        0 0 0 1px rgba(178,139,71,0.35);
      transition:
        background .35s ease,
        box-shadow .35s ease,
        transform .25s ease,
        opacity .25s ease;
      opacity:0;
      animation:chipFadeIn 1.1s ease-out forwards;
    }
    .chip::before{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:999px;
      z-index:-1;
      background:radial-gradient(
        circle,
        rgba(178,139,71,0.70) 0%,
        rgba(178,139,71,0.35) 35%,
        rgba(178,139,71,0.10) 65%,
        transparent 100%
      );
      filter:blur(8px);
      opacity:0.85;
      animation:haloPulseChip 5s ease-in-out infinite;
    }
    @keyframes haloPulseChip{
      0%,100%{transform:scale(0.9);opacity:0.6;}
      50%{transform:scale(1.12);opacity:1;}
    }
    @keyframes chipFadeIn{
      from{opacity:0;transform:translateY(-4px) scale(0.96);}
      to{opacity:1;transform:translateY(0) scale(1);}
    }
    .chip:hover{
      background:radial-gradient(circle at 30% 30%,
                #fbe9bf 0%, #e0b96f 40%, #c0924d 100%);
      box-shadow:
        0 4px 12px rgba(0,0,0,0.22),
        0 0 0 1px rgba(178,139,71,0.5);
    }
    .chip:active{transform:scale(0.97);}
    .chip:active::before{transform:scale(1.18);opacity:1;}

    select{
      appearance:none;
      border:1px solid rgba(131,120,104,0.5);
      background:rgba(255,255,255,0.92);
      color:var(--ink);
      border-radius:12px;
      padding:.45rem .9rem;
      font-size:.9rem;
      font-family:inherit;
    }
    select:focus{
      outline:2px solid #b28b47;
      outline-offset:1px;
    }

    @media (prefers-color-scheme: dark){
      body{
        background:
          radial-gradient(900px 700px at 50% -10%, rgba(255,255,255,0.08), transparent 70%),
          radial-gradient(700px 600px at 50% 110%, rgba(255,255,255,0.05), transparent 70%),
          linear-gradient(to bottom,#050509,#05060b);
        color:#f7f7f7;
      }
      header{
        background:color-mix(in oklch,#050509 86%, #000);
        border-bottom-color:rgba(255,255,255,0.07);
      }
      select{
        background:rgba(15,23,42,0.9);
        border-color:rgba(148,163,184,0.7);
        color:#f7f7f7;
      }
    }

    @media (prefers-reduced-motion: reduce){
      .chip{animation:none;}
      .chip::before{animation:none;}
    }

    /* Zentrum: vertikal zentrierter Ablauf */
    main{
      min-height:calc(100vh - 60px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:2.5rem 1rem 3rem;
    }
    .stage{
      max-width:620px;
      width:100%;
      margin:0 auto;
      padding:2.4rem 1.9rem 2.6rem;
      border-radius:24px;
      background:rgba(255,255,255,0.9);
      box-shadow:
        0 16px 34px rgba(0,0,0,0.10),
        0 0 0 1px rgba(0,0,0,0.04);
      position:relative;
      text-align:center;
    }
    @media (prefers-color-scheme: dark){
      .stage{
        background:rgba(10,10,12,0.92);
        box-shadow:
          0 16px 40px rgba(0,0,0,0.80),
          0 0 0 1px rgba(148,163,184,0.30);
      }
    }

    .page-title{
      margin:0 0 2rem;
      font-size:clamp(1.4rem,1.1rem + 1.2vw,1.9rem);
      letter-spacing:.18em;
      text-transform:uppercase;
    }

    /* Kreis */
    .circle{
      width:200px;
      height:200px;
      border-radius:50%;
      border:3px solid #111;
      display:grid;
      place-items:center;
      margin:0 auto 2rem;
      animation:pulse 3s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{box-shadow:0 0 10px #c4c4c4; transform:scale(1);}
      50%{box-shadow:0 0 20px #000; transform:scale(1.03);}
    }
    @media (prefers-color-scheme: dark){
      .circle{
        border-color:#f7f7f7;
        box-shadow:0 0 12px rgba(15,23,42,0.6);
      }
    }
    #counter{
      font-size:2rem;
      font-weight:700;
    }

    .illusion{
      font-size:1.2rem;
      margin-top:2rem;
    }
    .illusion-label{
      opacity:0.6;
    }

    /* Implosion des Kreises */
    .implode{
      animation:implode .6s ease-in-out forwards;
    }
    @keyframes implode{
      0%{opacity:1;transform:scale(1);}
      100%{opacity:0;transform:scale(0.2);}
    }

    /* Hauptsatz verschwimmt langsam */
    @keyframes blurOut{
      0%{opacity:1;filter:blur(0);}
      50%{opacity:0.9;filter:blur(2px);}
      100%{opacity:0;filter:blur(8px);}
    }
    .blur-out{
      animation:blurOut 4s ease forwards;
    }

    /* Paradoxon-Hinweis blinkt kurz auf */
    @keyframes hintPulse{
      0%{opacity:0;letter-spacing:.02em;}
      20%{opacity:.95;letter-spacing:.08em;}
      60%{opacity:.9;letter-spacing:.06em;}
      100%{opacity:0;letter-spacing:.02em;}
    }
    .paradox-hint{
      font-size:.95rem;
      margin-top:.5rem;
      opacity:0;
      animation:hintPulse 3s ease forwards;
    }

    /* Punkt: Aufpoppen + Herzschlag */
    @keyframes popIn{
      0%{transform:scale(0.6);opacity:0;}
      60%{transform:scale(1.15);opacity:1;}
      100%{transform:scale(1);opacity:1;}
    }
    @keyframes heartbeat{
      0%,100%{transform:scale(1);}
      50%{transform:scale(1.08);}
    }
    #relief{
      margin-top:1.8rem;
      font-size:2.8rem;
      line-height:1;
      border:none;
      background:none;
      color:var(--ink);
      cursor:pointer;
      opacity:0;
      transform:scale(0.8);
    }
    #relief.pop-in{
      animation:popIn 0.8s ease-out forwards, heartbeat 2.8s ease-in-out infinite 1s;
    }

    /* Übergangskreis */
    #transition-circle{
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:10px;
      height:10px;
      background:#111;
      border-radius:50%;
      z-index:9999;
      opacity:0;
      transition:transform 3.2s ease-in, opacity 2.6s ease-out;
    }
    @media (prefers-color-scheme: dark){
      #transition-circle{background:#f7f7f7;}
    }

    /* Textausrichtung um den Kreis herum */
    #title{margin-bottom:2rem;}
    #circle{margin:0 auto;}
    #illusion{margin-top:2rem;}

    /* kleine Info-Zeile */
    #paradoxWrap{
      margin-top:1rem;
      min-height:3.4rem;
    }

    footer.page-foot{
      margin-top:1.6rem;
      font-size:.85rem;
      color:var(--muted);
      text-align:center;
    }

    @media (max-width:640px){
      .wrap{padding:0.45rem 0.75rem;}
      main{padding:2rem 0.85rem 3rem;}
      .stage{
        padding:2rem 1.3rem 2.2rem;
        border-radius:20px;
      }
      .circle{
        width:170px;
        height:170px;
      }
      #counter{
        font-size:1.7rem;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="wrap row">
    <div class="row" aria-label="Brand">
      <a href="../index.html"
         class="chip"
         id="chipHome"
         aria-label="Zur Startseite justthisspace">
        JTS
      </a>
      <strong class="title-head" id="headerTitle">illusionen entladen</strong>
    </div>
    <div class="spacer"></div>
    <div class="row" aria-label="Language controls">
      <label for="lang" class="muted" id="langLabel">Sprache</label>
      <select id="lang" aria-label="Sprache wählen">
        <option value="de">Deutsch</option>
        <option value="en">English</option>
        <option value="fr">Français</option>
      </select>
    </div>
  </div>
</header>

<main>
  <section class="stage" aria-label="Illusionen entladen – Ablauf">
    <h1 id="title" class="page-title">Illusionen entladen</h1>

    <div class="circle" id="circle" aria-hidden="true">
      <span id="counter">100%</span>
    </div>

    <div id="illusion" class="illusion">
      <span class="illusion-label" id="illusionLabel">Illusion:&nbsp;</span>
      <span id="illusion-word"></span>
    </div>

    <div id="paradoxWrap"></div>

    <button id="relief" aria-label="Weiter">•</button>

    <footer class="page-foot" id="foot">
      © justthisspace — schon jetzt. schon genug.
    </footer>
  </section>
</main>

<div id="transition-circle"></div>

<audio id="pop-sound" src="pop.mp3" preload="auto"></audio>
<audio id="pulse-sound" src="celestial-gong-191122.mp3" preload="auto"></audio>

<noscript>
  <style>
    /* Bei deaktiviertem JS: Animationen ausblenden, simpler Text */
    .circle,#illusion,#paradoxWrap,#relief,#transition-circle{display:none!important;}
    .stage{padding-top:2.2rem;}
  </style>
  <div class="wrap" style="max-width:620px;margin:1rem auto 3rem;font-size:0.96rem;">
    <p>
      Diese Seite zeigt normalerweise einen kleinen Ablauf, in dem scheinbare
      „Illusionen“ nach und nach entladen werden – nur um zu sehen, dass nie
      wirklich etwas fest war.
    </p>
    <p>
      Ohne JavaScript bleibt einfach dies hier: schon jetzt. schon genug.
    </p>
  </div>
</noscript>

<script>
const T = {
  de: {
    brand: "JTS",
    headerTitle: "illusionen entladen",
    title: "Illusionen entladen",
    langLabel: "Sprache",
    illusionLabel: "Illusion:",
    foot: "© justthisspace — schon jetzt. schon genug.",
    illusions: ["Ich","Zeit","Glaube","Erfolg","Trennung","Ziel","Verlust","Sinn","Beginn","Form","Antwort","Name"],
    all: "alle Illusionen entladen.",
    paradox: "Paradoxon: Entladen findet nie statt."
  },
  en: {
    brand: "JTS",
    headerTitle: "discharging illusions",
    title: "Discharging Illusions",
    langLabel: "Language",
    illusionLabel: "Illusion:",
    foot: "© justthisspace — already now. already enough.",
    illusions: ["I","time","belief","success","separation","goal","loss","meaning","beginning","form","answer","name"],
    all: "discharging all illusions.",
    paradox: "Paradox: discharge never actually happens."
  },
  fr: {
    brand: "JTS",
    headerTitle: "décharger les illusions",
    title: "Décharger les illusions",
    langLabel: "Langue",
    illusionLabel: "Illusion :",
    foot: "© justthisspace — déjà maintenant. déjà suffisant.",
    illusions: ["moi","temps","croyance","réussite","séparation","but","perte","sens","début","forme","réponse","nom"],
    all: "toutes les illusions sont déchargées.",
    paradox: "Paradoxe : la décharge n’a jamais vraiment lieu."
  }
};

const $ = sel => document.querySelector(sel);

const el = {
  headerTitle: $('#headerTitle'),
  title: $('#title'),
  label: $('#langLabel'),
  select: $('#lang'),
  chip: $('#chipHome'),
  illusionLabel: $('#illusionLabel'),
  foot: $('#foot'),
  circle: $('#circle'),
  counter: $('#counter'),
  illusionWord: $('#illusion-word'),
  paradoxWrap: $('#paradoxWrap'),
  relief: $('#relief'),
  pop: $('#pop-sound'),
  gong: $('#pulse-sound'),
  tCircle: $('#transition-circle')
};

let state = {
  count: 100,
  intervalId: null,
  illusionList: [],
  texts: T.de
};

function getStoredLang(){
  try{
    return window.localStorage.getItem('jts-i18n-lang');
  }catch(e){
    return null;
  }
}
function storeLang(lang){
  try{
    window.localStorage.setItem('jts-i18n-lang', lang);
  }catch(e){}
}
function getNavigatorLang(){
  try{
    return (navigator.language || 'de').slice(0,2);
  }catch(e){
    return 'de';
  }
}

function renderStatic(lang){
  const t = T[lang] || T.de;
  state.texts = t;

  document.documentElement.lang = lang;
  document.title = t.title + " – justthisspace";

  if (el.headerTitle) el.headerTitle.textContent = t.headerTitle;
  if (el.title) el.title.textContent = t.title;
  if (el.label) el.label.textContent = t.langLabel;
  if (el.illusionLabel) el.illusionLabel.textContent = t.illusionLabel + " ";
  if (el.foot) el.foot.textContent = t.foot;
  if (el.chip) el.chip.textContent = t.brand;
}

function startSequence(){
  const { illusions } = state.texts;
  state.illusionList = illusions.slice();
  state.count = 100;

  if (!el.counter || !el.illusionWord) return;

  // Reset UI
  el.counter.style.display = '';
  el.counter.textContent = '100%';
  el.circle.classList.remove('implode');
  el.paradoxWrap.innerHTML = '';
  el.relief.classList.remove('pop-in');
  el.relief.style.opacity = 0;

  // Intervall starten
  state.intervalId = setInterval(() => {
    el.counter.textContent = state.count + "%";

    if (state.count % 7 === 0 && state.illusionList.length > 0) {
      el.illusionWord.textContent = state.illusionList.shift();
    }

    state.count--;
    if (state.count < 0) finishSequence();
  }, 120);
}

function finishSequence(){
  clearInterval(state.intervalId);

  if (el.pop) {
    el.pop.play().catch(()=>{});
  }
  el.circle.classList.add('implode');
  el.counter.style.display = 'none';

  const { all, paradox } = state.texts;

  // Hauptsatz nach 2s
  setTimeout(() => {
    const mainLine = document.createElement('div');
    mainLine.textContent = all;
    mainLine.className = 'mt-3 text-2xl tracking-wider blur-out';
    el.paradoxWrap.appendChild(mainLine);

    // Paradox nach 1.5s
    setTimeout(() => {
      const hint = document.createElement('div');
      hint.textContent = paradox;
      hint.className = 'paradox-hint';
      el.paradoxWrap.appendChild(hint);
    }, 1500);

    // Punkt nach weiteren 4s
    setTimeout(() => {
      el.relief.style.display = 'inline-block';
      el.relief.classList.add('pop-in');

      // Auto-Proceed nach 2s (kein Klick nötig)
      setTimeout(() => {
        proceed();
      }, 2000);
    }, 4000);

  }, 2000);
}

function proceed(){
  if (el.gong) {
    el.gong.play().catch(()=>{});
  }
  setTimeout(() => {
    el.tCircle.style.opacity = '1';
    el.tCircle.style.transform = 'translate(-50%, -50%) scale(100)';
  }, 1000);

  setTimeout(() => {
    document.body.classList.add('fadeout');
  }, 2000);

  setTimeout(() => {
    window.location.href = 'start.html';
  }, 3000);
}

(function init(){
  if (!el.select) {
    return;
  }

  const supported = ['de','en','fr'];
  const stored = getStoredLang();
  const nav = getNavigatorLang();
  const candidate = stored || nav || 'de';
  const initial = supported.includes(candidate) ? candidate : 'de';

  el.select.value = initial;
  renderStatic(initial);
  storeLang(initial);

  el.select.addEventListener('change', e => {
    const lang = e.target.value;
    renderStatic(lang);
    storeLang(lang);
    // Sequenz neu starten beim Sprachwechsel
    clearInterval(state.intervalId);
    el.illusionWord.textContent = '';
    startSequence();
  });

  // Einstieg-Sequenz starten
  startSequence();

  el.relief.addEventListener('click', proceed);
})();
</script>
</body>
</html>
